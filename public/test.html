<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yatzy Dice Roller</title>
    <script type="module" src="assets/dice.js"></script>
    <script type="module" src="assets/yatzy_game.js"></script>
    <script type="text/javascript" src="assets/yatzy_engine.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<h1>Yatzy Dice Roller</h1>
<h2>Dice Rolled</h2>
<div id="diceOutput"></div>
<button id="rollButton">Roll Dice</button>
<p>Rolls remaining: <span id="rollsRemaining"></span></p>

<table id="scoreCard">
    <tbody>
    <tr>
        <td></td>
        <th>Max</th>
        <th>Score</th>
    </tr>
    <tr>
        <th colspan="3">Upper Section</th>
    </tr>
    <tr id="ones">
        <th>1's</th>
        <td>5</td>
    </tr>
    <tr id="twos">
        <th>2's</th>
        <td>10</td>
    </tr>
    <tr id="threes">
        <th>3's</th>
        <td>15</td>
    </tr>
    <tr id="fours">
        <th>4's</th>
        <td>20</td>
    </tr>
    <tr id="fives">
        <th>5's</th>
        <td>25</td>
    </tr>
    <tr id="sixes">
        <th>6's</th>
        <td>30</td>
    </tr>
    <tr id="upperSum">
        <th>Sum</th>
        <td>0</td>
    </tr>
    <tr id="bonus">
        <th>Bonus</th>
        <td>50</td>
    </tr>
    </tbody>
    <tr>
        <th colspan="4">Lower Section</th>
    </tr>
    <tr id="onePair">
        <th>One Pair</th>
        <td>0</td>
    </tr>
    <tr id="twoPairs">
        <th>Two Pairs</th>
        <td>22</td>
    </tr>
    <tr id="threeOfAKind">
        <th>Three of a Kind</th>
        <td>18</td>
    </tr>
    <tr id="fourOfAKind">
        <th>Four of a Kind</th>
        <td>24</td>
    </tr>
    <tr id="smallStraight">
        <th>Small Straight</th>
        <td>0</td>
    </tr>
    <tr id="largeStraight">
        <th>Large Straight</th>
        <td>0</td>
    </tr>
    <tr id="fullHouse">
        <th>Full House</th>
        <td>28</td>
    </tr>
    <tr id="chance">
        <th>Chance</th>
        <td>0</td>
    </tr>
    <tr id="yatzy">
        <th>Yatzy</th>
        <td>0</td>
    </tr>
    <tr id="total">
        <th>Total</th>
        <td>374</td>
    </tr>
</table>

<script type="module">
    import YatzyGame from '/public/assets/yatzy_game.js';

    const game = new YatzyGame();
    const rollButton = document.getElementById('rollButton');
    const diceOutput = document.getElementById('diceOutput');
    const scoreOutput = document.getElementById('scoreCard');
    const rows = scoreOutput.rows;
    const rollsRemaining = document.getElementById('rollsRemaining');


    rollsRemaining.innerHTML = game.rollsRemaining;
    rollButton.addEventListener('click', () => {
        game.rollDice();
        render();
    });

    function render() {
        // clear dice
        diceOutput.innerHTML = "";
        //re-render dice
        game.dices.forEach((dice) => {
            diceOutput.appendChild(dice.render());
        });
        renderScoreCard();
        rollsRemaining.innerHTML = game.rollsRemaining;
    }

    function renderScoreCard() {
        let diceState = game.getDice();

        for (let row of rows) {
            row.removeChild(row.lastChild)
            let td = document.createElement('td')
            let id = row.id;
            //remove click event listener (to make rerendering quick).
            row.removeEventListener('click', row.fn);

            if (id !== "") {
                if (game.scoreState[id] === undefined) {
                    let func = `calculate${id.charAt(0).toUpperCase() + id.slice(1)}(game.scoreState)`;
                    td.innerHTML = eval(func);
                } else if (game.scoreState[id] !== null) {
                    row.className = 'used';
                    td.innerHTML = game.scoreState[id];
                } else {
                    // store reference to function so it can be deleted
                    row.addEventListener('click', row.fn = () => {
                        game.selectScore(id);
                        render();
                    });
                    let func = `calculate${id.charAt(0).toUpperCase() + id.slice(1)}(diceState)`;
                    td.innerHTML = eval(func);
                }
            }
            row.append(td);
        }
    }
</script>
</body>
</html>